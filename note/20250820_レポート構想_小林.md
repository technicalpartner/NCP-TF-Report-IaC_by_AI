以下、記載内容についてレポートを作成してください。レポートは report_by_sonnet に格納してください。




レポートの想定読者

ある、システム開発会社の部長以上幹部層
システム開発会社は比較的レガシーな開発体制を取っており、最新技術の導入に関してはあまり進んでいない。
最新技術のキャッチアップについてもあまり積極的ではないため、今回のレポートは最新技術のキャッチアップについても同期付けになると良いと思っている。

費用対効果など、企業の導入検討を目的としたも内容でなく、現場のエンジニアの体験、気付きを共有する内容にする。

レポートの主題

- クラウド推進部 40期目標として IaCの実装検証を行った。
- IaC実装検証の中で生成AIを活用した。
- 特に生成AIにTerraformのコードを生成させる中で様々な学びがあった。
- 今後のシステム開発において生成AIを活用するにあたり、Terraformコード生成で得た学びを活かしたい。
- 検証内容についてはIaCにおける利用に特化している部分が多いが、システム開発全般に活かせる知見に関しても記載したい。

- 背景
- GPT-3.5の発表以降生成AIの活用について模索してきた。2025年初頭あたりから生成AIのコーディング能力の向上、エージェント実行方式を使用する開発ツールが複数発表されるなどシステム開発における生成AI活用の機運が急速に高まっている。

生成AI活用の方法としてTerraformのコードを生成AIに生成させてみた


生成AIの基盤モデル選定
  - コード生成以前からClaude 3.5 Sonnetをメインに使用していた。
    - Amazon Bedrockを通じて利用できる
    - 能力の評価(Claude 3.5 Sonnet)
      - 日本語の理解度が高い。特に長文のプロンプトの場合は2024年の時点では英文と日本語で出力に差があることが多かったがClaudeはそこまで大きな差がなかった。
      - プログラミングの能力が高い

  - エージェント型の実行形式のコード生成機能を評価。コード生成ではCursorを使用することとした。
    - Cline
       - VsCodeの拡張機能
       - Amazon Bedrockを通じて利用可能
       - エージェントモードあり
       - 入出力トークンによる従量課金
    - Cursor
       - VsCodeのフォークで作成されたテキストエディタ
       - 検証当時はリクエスト数による課金。特にエージェントモードはエージェントの動作が終了するまでが1リクエストのためトークン従量課金に比べて大幅にやすい。
       - 最新の基盤モデルの対応が早い。
       - Claudeのモデルを使用可能

  - IaCにおける基盤モデルと開発方法の選定基準
  
  - DPIaC-Eval（Deployability-Centric Infrastructure-as-Code Evaluation）
     実運用でのデプロイ可能性を重視した初のIaC（Infrastructure as Code）テンプレート生成ベンチマーク。
     
     基盤モデル
       Claude 3.7 Sonnetが最高評価を示す。
     反復的フィードバック（Iterative Feedback）が有効
     以下のチェックと
       ユーザー意図適合性
         - 生成AIによる要件定義書、設計書との適合性チェック
            - ユーザーレビューによるフィードバック
            - 生成AIによるコードと要件定義書、設計書の整合性チェック
       デプロイ時のエラーメッセージ
       セキュリティ検査
         - コード解析ツールによるセキュリティ検査
         - 生成AIによるセキュリティ規約、ガイドラインとコードの整合性チェック
       構文チェック
         - コード解析ツールによる構文チェク
         - 生成AIによるコーディングルールとコードの整合性チェック


実装検証は以下の③パターンを実施

①

Terraformのリソース、設定を全て指定。
DPIaC-Evalで指摘されている反復的フィードバックは、設計書、コーディングルールを更新
エージェントによるコードの一括生成の成功を目指す。
  → 一括生成は成功

- Terraformのリソースとリソースの関係を全て図に示す
  - リソースをグルーピングしたTerraformモジュールの単位についても図に記載
  - リソースの設定値については明示が必要な設定は全て指定
- 図の記法は独自記法を使用
  - 生成AIに指示するためPlantUMLやmermaidなど、テキストで表現できる図記法を検討した
  - UMLのクラス図、オブジェクト図、E-r図などを検討したがTerraformのリソースの相関を示すには使いづらかった。
  - 生成に使用する基盤モデルClaude 3.5 Sonnet、Claude 3.7 Sonnetが画像認識できるため、独自記法の図を作成して生成させたとことコードの生成ができた。
  - 独自記法の図の解釈はテキストで記載してコード生成の依頼時に同時に与えた。

　→ 生成AIによるコード生成に成功
　　 作業者によるTerraformコーディングと比べて作業時間が短縮されない。
　　 常に設計書からコード生成する開発プロセスはよい。可読性が向上する。
②
AWSの設定の要点、Terraformのコーディングルールを指定
DPIaC-Evalで指摘されている反復的フィードバックは、設計書、コーディングルールを更新
エージェントによるコードの一括生成の成功を目指す。
  → 一括生成は成功

　①ではTerraformのコーディングを行うために必要な技術とコーディングを行うのとほぼ同等の時間が必要だった

　→ コード生成はできるが再現性が低い
　　・同一基盤モデルでも設計書で指定しない設定値は生成する度にぶれる
　　・基盤モデルが変わると、設計書の書き方を０から見直す必要がある。
　→ 
　　　設計書、Terraformコーディングルール記載内容の向上が課題。
　　　①より伸びしろあり。

③
アプリケーションの概要とAWSのサービス名を指定
DPIaC-Evalで指摘されている反復的フィードバックは、設計書、コーディングルールを更新
- 設計書
- デプロイエラーメッセージ
- アプリケーションの動作確認で発生したアプリケーションのエラーメッセージ
をもとにコードを修正。Terraformコードとアプリケーションのコードを同時に修正

　→ アプリケーションとTerraformコードを同時にデバッグ。
　　 デバッグを繰り返して動作する環境はできた。
 
　　・アプリケーションの動く環境を作るまでの時間は大きく短縮
　　・コードはデバッグを繰り返す。全く同じコードを作ることは不可能
　　・生成AIは指示されたエラーメッセージの対応を最優先する結果、設計書との整合性が崩れる場合がある。
　　　アプリケーションのアーキテクチャとシステム構成を理解している技術者が生成AIの修正方針を都度チェックする必要がある。
 

生成AIとの付き合い方

生成AIがコードを壊すことを前提としたソース管理をする。
- 生成AIは指示した人の意図しない修正をすることがある
- コード生成の前にはGitコミットなど復元可能なチェックポイントを作成する。
- Gitの活用方事例を紹介


明文化したドキュメントの質と量が重要

- 要件定義書、設計書、コーディング規約など明文化したドキュメントが重要になる。
- 有識者のレビューによるフィードバックの際にもルールの更新の形で修正することで次回以降のコード生成の結果が良くなる。

開発プロセスの遵守

- 生成AIのエージェントは、明確に指示しないと勝手にコードを修正し始める。
  - 指示を明確にして、開発プロセスを遵守させる。
  - エージェントの権限を制限する。
    - 操作可能なユーザーを与えない。不要なシークレット情報をAIの操作可能な範囲に置かない
    - Cursorの設定で縛る
    - Cursorのルールで縛る

生成AIをレビュアーとして活用する。

  生成AIは常に全ての知識、技術を活用した完全な作業をするわけではない。
  与えた、観点、要求に応じて出力の精度は変わる

  設計書、コーディングルールのレビューの原案作成、レビューにも活用
  作業者との対話を繰り返して内容のブラッシュアップを行う

  コード生成に関しても生成後にチェックさせる。
    → 設計書との整合性
    → セキュリティ上の脆弱性
    → コーディングルール


 
