# IaCにおける生成AI活用レポート

## 1.1. 背景・目的

クラウド推進部の40期の目標として、IaCの実装検証を行った。

実装検証においては、当初Terraformの学習支援およびコーディング支援の目的で生成AIを活用していた。しかし、検証を進める中で生成AIの高い性能を確認できたため、Terraformのコーディング作業自体を生成AIに担わせることを本格的に検討し、実施した。

本レポートは、これまでの実施実績をもとに、IaC領域における生成AI活用の可能性について検証し、複数の手法ごとに得られた知見や考察を体系的に整理・まとめたものである。

本レポートでは、40期の目標である「IaCの実装検証」と区別するため、IaCコードのAI生成に関する取り組みを「本検証」と記載する。


## 1.3. 基盤モデル、ツールの選定

本検証で使用する生成AIの基盤モデル、開発ツール選定する。
基盤モデル、開発ツールの選定にあたり、IaCにおける生成AIの性能を評価したベンチマーク「DPIaC-Eval」を参考にした。

#### DPIaC-Evalの概要

- 基盤モデルは Claude 3.5、Claude 3.7 が最も評価が高い。
- 


## 1.3. 検証結果

本検証では、それぞれの手法は、選定した基盤モデルと開発ツールを使用し、以下の指針に従って生成を行った。
- 設計書とコーディングルールを与え、コード生成指示（プロンプト）を実行する
- 一回のプロンプトで、目的とする設計すべてのコーディングを完了できること
- コード生成指示から作業タスクへの分割、生成完了までの反復実行は開発ツールにより自動で実行する。
- 生成AI自身が、生成したコードと設計書の比較を行い、誤りを検出できること
- コード生成失敗時は、プロンプト、設計書、コーディングルールのいずれかを修正して再実行

これにより、高い再現性をもって生成AIによるコーディングを実現することができ、その結果、以下3つの開発手法を確立することができた。
- 開発手法① Terraform詳細設計に基づくコード生成
- 開発手法② AWS詳細設計書に基づくコード生成
- 開発手法③ システム要件に基づくコード生成

それぞれの手法について、要求される技術は以下の通りとなる。

| 知識・技術 | 開発手法① | 開発手法② | 開発手法③ |
| --- | --- | --- | --- |
| Terraformコーディング技術 | ○ | ✗ | ✗ | 
| AWSの設計技術 | ○ | ○ | ✗ | 
| AWSの基礎知識 | ○ | ○ | ○ | 


## 1.3. 評価
それぞれの開発手法において、以下の観点で比較を行った。
| # | 観点 | 説明 |
| - | ---- | ------ |
| 1 | 設計時間 | 生成AIがコーディングできる状態の設計書を作成するための時間 |
| 2 | 完成度 | 生成されたコードから環境の構築がスムーズに行えること |
| 3 | 再現性 | コード生成の再現性（コード生成を繰り返し実行したときに同じコードが生成されること）|
| 4 | 適合性 | 生成したコードはセキュリティや冗長化など、必要な要件を満たすコードになること|
| 5 | 可読性 | 生成したコードは読みやすく、人の手による継続的なメンテナンスが可能なこと |

生成AIによるコーディングが手動コーディングより早いことは自明なため、単純なコーディング時間の比較は評価項目の対象外とする。

これらを踏まえた、それぞれの手法における評価は以下の通り。
| # | 観点 | 開発手法① | 開発手法② | 開発手法③ | 基準 |
| - | ---- | ---- | ---- | ---- | ---- |
| 1 | 設計時間 | 2 | 4 | 4 | 設計時間が少ないほど高評価 |
| 2 | 完成度 | 5 | 3 | 2 | 手直し回数が少ないほど高評価 |
| 3 | 再現性 | 5 | 4 | 2 | コードの類似正が高いほど高評価 |
| 4 | 適合性 | 2 | 3 | 3 | 要件適合度が高いほど高評価 |
| 5 | 可読性 | 5 | 3 | 1 | 設計書とコードの対応が明確なほど高評価 |


### 1.3.1. 開発手法① Terraform詳細設計に基づくコード生成
Terraform詳細設計書をもとに、生成AIにTerraformコードを生成させる手法。

本手法では、AWSシステム構成図、AWS基本設計書、Terraformモジュール設計書、デザインルールの4要素からなる設計書を作成する

要求技術：大
時間：大
可読性：良

##### 結論
本手法は、生成されるコードに高い再現性が認められ、保守性および可読性の観点からも優れている。しかしながら、これらの利点を得るためには、一次ソースの作成に高度な技術を要し、設計時間も長期化する傾向がある。したがって、実用性の観点からは必ずしも最適な手法とは評価し難い。

### 1.3.2. 開発手法② AWSの詳細設計書に基づくコード生成
AWS詳細設計書をもとに、生成AIにTerraformコードを生成させる手法。

要求技術：中
時間：中
可読性：中

##### 結論
開発手法①において指摘された「設計の長期化」および「Terraform技術の獲得」に関する課題については、開発手法②の導入により一定の改善が認められた。特に、同一のAI基盤モデルおよび同一バージョンを用いた場合、開発手法①と比較して精度は若干劣るものの、繰り返しのコーディングにおいて類似性の高いコードが生成される傾向が観察された。このことから、保守性および可読性の観点においても本手法は有効であると考えられる。したがって、開発および運用の両面から本手法の更なる発展が期待される。

一方で、同一AI基盤モデルであってもバージョンが異なる場合には、生成されるコードの類似性が著しく低下する事例が確認されており、この点が本手法の課題として挙げられる。

### 1.3.3. 開発手法③ システム要件に基づくコード生成
AWSで実現したいことをベースに、生成AIにTerraformコードを生成させる手法。

要求技術：小
時間：小
可読性：悪


## 1.4. 本検証より得られた考察

##### 1.4.1. 開発プロセス

3つの開発手法において、設計プロセスはそれぞれ異なるものの、コード生成からAWS上の環境生成完了までの開発プロセスは同一となる。

以下に実施したプロセスを記載する。

- （1） 設計  
       想定ケース毎に担当者の技術に応じた設計書を作成する。  
       設計書の記載ルール、コーディングルールなどを作成する。
- （2） コード生成  
       「(1) 設計」で作成した設計書とルールを与えて生成AIにTerraformのコードを生成させる。  
- （3） IaCコード解析、レビュー  
        生成されたTerraformのコードをチェックして、改善箇所を指摘する。指摘がある場合は、設計書とルールを修正して「(2)コード生成」を再実行する。  
        Terraformのコードのチェックには以下の機能を使用する。
        - ① コード解析ツール
        - ② 生成AIによるレビュー
        - ③ 担当者によるレビュー
- （4） 構築  
       Terraformのコマンドを実行してAWS上に環境を構築する。  
       生成AIはTerraformのコマンドを監視する。エラーが発生した場合はTerraformコードを修正してコマンドを再実行する。
- （5） 構築結果確認、動作検証  
       担当者により、AWS上に構築された環境を目視確認と、システムの動作確認を行う。  
       不具合がある場合は設計書とルールを修正して「(2)コード生成」から再実行する。  


##### 1.4.2. 作業時間の短縮効果

- (1) Terraformのコーディングを行う作業時間は大幅に短縮される。
- (2) Terraformのコーディング以外の作業時間はほぼ増減なし。

##### 1.4.3. 品質に与える影響

- (1) 以下の効果により、メンテナンスしやすい設計が保たれるようになる。
    - ① 設計書を修正してTerraformコードを生成する手順が守られる。
    - ② 設計書修正から環境の再構築のサイクルが早い。

##### 1.4.4. 技術者の育成に与える影響

生成AIを活用してコード生成を行うと、Terraformの基礎学習を行わずともIaCを用いた学習プロセスが体験できる。

このことは、IaCに関する理解を促進するためには有効であるが、一方でTerraformに関する理解が不足したまま構築を行う危険がある。

対策として、開発リーダーによるメンバーの理解度のチェックを行う必要がある。

## 1.4. まとめ

IaCに生成AIを活用することで作業時間の短縮効果がある。また、技術者の育成にも一定の効果はあるが生成AIに依存するため必要な技術が習得できない危険がある。

生成AIの特徴をよく理解して使用することが重要となる。